esp icindeki cod 
#include <WiFi.h>
#include <WebSocketsClient.h>
#include <Wire.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_BME280.h>
#include <HardwareSerial.h>
#include <MHZ19.h>

// ==========================================
// 1. AÄž VE SUNUCU AYARLARI (SSL AKTÄ°F)
// ==========================================
const char* ssid = "HavaKalitesi";      
const char* password = "12345678";
const char* websocket_server_host = "10.42.0.1"; 
const uint16_t websocket_server_port = 3000;

// ==========================================
// 2. PIN AYARLARI
// ==========================================
#define RX_PIN_MHZ19 16  
#define TX_PIN_MHZ19 17  
#define RX_PIN_PMS 18    
#define TX_PIN_PMS 19    

// ==========================================
// 3. NESNELER
// ==========================================
WebSocketsClient webSocket;
Adafruit_BME280 bme;
MHZ19 myMHZ19;

HardwareSerial SerialMHZ(2); 
HardwareSerial SerialPMS(1); 

struct PMS_Data {
  uint16_t PM_1_0;
  uint16_t PM_2_5;
  uint16_t PM_10_0;
};
PMS_Data pms;

// SERTÄ°FÄ°KA (Test_root_ca) 
// Not: Kodun yapÄ±sÄ±nÄ± bozmadÄ±m, orijinalindeki gibi bÄ±raktÄ±m.
const char* test_root_ca = R"EOF(
-----BEGIN CERTIFICATE-----
MIIDkzCCAnugAwIBAgIUHK6GZt17o02cC1gzT67pRF4dBOwwDQYJKoZIhvcNAQEL
BQAwWTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoM
GEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDESMBAGA1UEAwwJMTAuNDIuMC4xMB4X
DTI2MDEwMjEyNTcxNVoXDTI3MDEwMjEyNTcxNVowWTELMAkGA1UEBhMCQVUxEzAR
BgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5
IEx0ZDESMBAGA1UEAwwJMTAuNDIuMC4xMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8A
MIIBCgKCAQEAx1skTpjzViarPhwZky0cy7TqYOdKKlhL6Rb4N1Xw2lXDBJzWAV+q
IV7XusKOPIE4CGCjMEGILAkiBpystNDZHO2fh8uIcTCnl9MZT6841s+Mj9cW9a1o
mBquL64p7HKRa0DLvmaKKjPUaSEuyF+iVVLn7H3Hac+dFUEzx7xYPDtG9/WMPdbM
Xfi7N03ZLxDAYnD0uLqjk7Xhawsm1iLlZtorgHEjbzw6Pt5cYS4ZYBwcYelJpWu+
+GQ/1kfmx6iIfxFW/S3Wf3nvzwXtvwjSnata1cnkGJSrQOK4vVnQR1bMDs7aT7Sf
crRlWFvrtn7g0mn7adrr4BQ8DU65ESx08wIDAQABo1MwUTAdBgNVHQ4EFgQU4Z+0
od/aKsNtYt36/lhEMT4EbVAwHwYDVR0jBBgwFoAU4Z+0od/aKsNtYt36/lhEMT4E
bVAwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAfLS/2+c/of+G
G21L0k9w6/hdyD+eeQ/tX9YZc7mZaMjyBIxQHpOWc7qFZM+znH/9nEnh+uh/7N+p
xZ4f1rixkutLuCGNHAP4JjtIMYzUQFGE6WJqTv+dIyFqS7YwnR+CMUYCt70JEMD9
r1DQDFrgDwf0YIp5XimzZZZw7xNFwMc/9CkpmIbUg+bUwCqedQLTBl3M6SLXuaKT
Sdn6PPtDuZk0wR0ZkJZessfsXrjO5xTCje4q5OqwAoXYI7f3jcaVLPhq7trjdj5S
TjozG5XkZD6A2wZlGV2tv6Dp8DZblhg2c34K/7w76ZSYJhmblRPP0E6oyYCMfy+3
VA68QBgP6g==
-----END CERTIFICATE-----
)EOF";

// ==========================================
// 4. YARDIMCI FONKSÄ°YONLAR
// ==========================================

bool readPMSdata(HardwareSerial &ser) {
  if (!ser.available()) return false;
  unsigned long start = millis();
  while (ser.available()) {
    if(millis() - start > 10) break; // BloklamayÄ± engelle
    if (ser.read() == 0x42 && ser.read() == 0x4D) {
      uint8_t buffer[30];
      if (ser.readBytes(buffer, 30) == 30) {
        pms.PM_1_0 = (buffer[8] << 8) | buffer[9];
        pms.PM_2_5 = (buffer[10] << 8) | buffer[11];
        pms.PM_10_0 = (buffer[12] << 8) | buffer[13];
        return true;
      }
    }
  }
  return false;
}

void webSocketEvent(WStype_t type, uint8_t * payload, size_t length) {
  switch(type) {
    case WStype_DISCONNECTED: Serial.println("[WSS] BaÄŸlantÄ± Koptu!"); break;
    case WStype_CONNECTED: Serial.println("[WSS] SSL BaÄŸlantÄ±sÄ± BaÅŸarÄ±lÄ±! âœ…"); break;
    case WStype_TEXT: Serial.printf("[WSS] Mesaj: %s\n", payload); break;
    case WStype_ERROR: Serial.println("[WSS] Hata!"); break;
  }
}

// --- ALGORÄ°TMA: BASÄ°T ORTALAMA (ESP TARAFI) ---
void sensorleriOkuVeGonder() {
  
  float toplamSicaklik = 0;
  float toplamNem = 0;
  long toplamCO2 = 0;
  int ornekSayisi = 5; // 5 kez oku, ortalama al

  // 1. Ã–rnekleme DÃ¶ngÃ¼sÃ¼ (GÃ¼rÃ¼ltÃ¼ Temizleme)
  for(int i=0; i<ornekSayisi; i++) {
    toplamSicaklik += bme.readTemperature();
    toplamNem += bme.readHumidity();
    
    int anlikCO2 = myMHZ19.getCO2();
    if(anlikCO2 < 400) anlikCO2 = 400; // Hata filtresi
    toplamCO2 += anlikCO2;
    
    delay(20); // Ã‡ok kÄ±sa bekleme
  }

  // 2. OrtalamalarÄ± Hesapla
  float avgSicaklik = toplamSicaklik / ornekSayisi;
  float avgNem = toplamNem / ornekSayisi;
  int avgCO2 = toplamCO2 / ornekSayisi;

  // Toz verisi (Serial olduÄŸu iÃ§in ortalama almak zordur, son deÄŸeri alÄ±yoruz)
  bool tozOkundu = readPMSdata(SerialPMS);
  int pm25_degeri = tozOkundu ? pms.PM_2_5 : 0; 
  if (isnan(avgSicaklik)) avgSicaklik = 0;
  if (isnan(avgNem)) avgNem = 0;

  Serial.printf("Olcum (Ort) -> Sicak: %.1f, Nem: %.1f, CO2: %d, PM2.5: %d\n", avgSicaklik, avgNem, avgCO2, pm25_degeri);

  // 3. GÃ¶nder
  String json = "{";
  json += "\"sicaklik\":" + String(avgSicaklik) + ",";
  json += "\"nem\":" + String(avgNem) + ",";
  json += "\"co2\":" + String(avgCO2) + ",";
  json += "\"pm25\":" + String(pm25_degeri);
  json += "}";
  
  webSocket.sendTXT(json); 
}

// ==========================================
// 5. SETUP
// ==========================================
void setup() {
  Serial.begin(115200);
  delay(1000);
  Serial.println("\n--- SISTEM BASLATILIYOR (SSL MODU) ---");

  if (!bme.begin(0x76)) Serial.println("âš ï¸ BME280 Yok!");
  else Serial.println("âœ… BME280 HazÄ±r.");

  SerialMHZ.begin(9600, SERIAL_8N1, RX_PIN_MHZ19, TX_PIN_MHZ19);
  myMHZ19.begin(SerialMHZ);
  myMHZ19.autoCalibration(false);
  Serial.println("âœ… MH-Z19 HazÄ±r.");

  SerialPMS.begin(9600, SERIAL_8N1, RX_PIN_PMS, TX_PIN_PMS);
  Serial.println("âœ… PM SensÃ¶rÃ¼ HazÄ±r.");

  WiFi.begin(ssid, password);
  Serial.print("Wi-Fi Bekleniyor");
  while (WiFi.status() != WL_CONNECTED) { delay(500); Serial.print("."); }
  Serial.println("\nâœ… Wi-Fi BaÄŸlandÄ±!");

  // SSL BAÅžLATMA (Senin istediÄŸin gibi)
  webSocket.beginSSL(websocket_server_host, websocket_server_port, "/");
  webSocket.onEvent(webSocketEvent);
  webSocket.setReconnectInterval(5000);
}

// ==========================================
// 6. LOOP
// ==========================================
void loop() {
  webSocket.loop();
  
  static unsigned long lastTime = 0;
  // 2 Saniyede bir gÃ¶nder (Algoritmalar iÃ§in ideal sÃ¼re)
  if (millis() - lastTime > 2000) { 
    lastTime = millis();
    sensorleriOkuVeGonder();
  }
} bu 

baslat.sh dosyasinin codu #!/bin/bash

# --- AYARLAR ---
UYGULAMA_ADI="HavalandÄ±rma Sistemi"
CALISMA_DIZINI="/home/aaron/HavaKalitesiArayuz"
SCRIPT_YOLU="$CALISMA_DIZINI/baslat.sh"
ICON_ADI="weather-clear" 
KUR_SCRIPT="$CALISMA_DIZINI/otomasyonu_kur.sh"

# --- RENKLER ---
YESIL='\033[1;32m'
MAVI='\033[1;34m'
KIRMIZI='\033[1;31m'
SARI='\033[1;33m'
CYAN='\033[1;36m'
NC='\033[0m'

# =================================================
#        Ã‡ALIÅžMA MODU KONTROLÃœ
# =================================================
MOD="yonetici"
if [[ "$1" == "--app-mode" ]]; then
    MOD="uygulama"
fi

# =================================================
#         1. FONKSÄ°YONLAR
# =================================================

function kisayol_olustur() {
    MENU_DOSYASI="$HOME/.local/share/applications/havalandirma.desktop"
    
    # MasaÃ¼stÃ¼ ve MenÃ¼ kÄ±sayolunu oluÅŸtur
    cat <<EOF > "$MENU_DOSYASI"
[Desktop Entry]
Type=Application
Name=$UYGULAMA_ADI
Comment=AkÄ±llÄ± Hava Kalitesi Kontrol Paneli
Exec=$SCRIPT_YOLU --app-mode
Icon=$ICON_ADI
Terminal=true
Categories=Utility;Engineering;
EOF
    chmod +x "$MENU_DOSYASI"
    update-desktop-database "$HOME/.local/share/applications" 2>/dev/null

    if [ -d "$HOME/Desktop" ]; then DESKTOP_DIR="$HOME/Desktop"; else DESKTOP_DIR="$HOME/MasaÃ¼stÃ¼"; fi
    MASAUSTU_DOSYASI="$DESKTOP_DIR/havalandirma.desktop"

    cp "$MENU_DOSYASI" "$MASAUSTU_DOSYASI"
    chmod +x "$MASAUSTU_DOSYASI"
    gio set "$MASAUSTU_DOSYASI" metadata::trusted true 2>/dev/null
}

# =================================================
#         2. YÃ–NETÄ°CÄ° MODU (Ä°LK KURULUM)
# =================================================
if [[ "$MOD" == "yonetici" ]]; then
    clear
    echo -e "${MAVI}=================================================${NC}"
    echo -e "${MAVI}   ðŸ› ï¸  $UYGULAMA_ADI - SÄ°STEM BAÅžLATILIYOR      ${NC}"
    echo -e "${MAVI}=================================================${NC}"
    echo ""
    
    echo -e "${CYAN}[KURULUM 1/2]${NC} MasaÃ¼stÃ¼ kÄ±sayolu kontrol ediliyor..."
    kisayol_olustur
    echo -e "${YESIL}>> KÄ±sayol hazÄ±r.${NC}"
    echo ""

    echo -e "${CYAN}[KURULUM 2/2]${NC} Otomasyon kontrol ediliyor..."
    if [ -f "$KUR_SCRIPT" ]; then 
        bash "$KUR_SCRIPT" > /dev/null 2>&1
        echo -e "${YESIL}>> Sistem baÅŸlangÄ±ca eklendi.${NC}"
    fi
    echo ""
    echo -e "${YESIL}âœ… Kurulumlar tamamlandÄ±. Sunucuya geÃ§iliyor...${NC}"
    sleep 2
fi

# =================================================
#         3. UYGULAMA MODU (SUNUCU BAÅžLATMA)
# =================================================

if [[ "$MOD" == "uygulama" ]]; then
    clear
    echo -e "${MAVI}=================================================${NC}"
    echo -e "${MAVI}   ðŸš€ $UYGULAMA_ADI AKTÄ°F (SSL MODU)          ${NC}"
    echo -e "${MAVI}=================================================${NC}"
fi

cd "$CALISMA_DIZINI" || { echo -e "${KIRMIZI}HATA: Dizin yok!${NC}"; read -p "Enter..." wait; exit 1; }

# --- HOTSPOT MANTIÄžI (ESKÄ° KODDAN GERÄ° GETÄ°RÄ°LDÄ°) ---
WIFI_ARAYUZ=$(nmcli device | grep wifi | grep -v p2p | awk '{print $1}' | head -n 1)

if [ -z "$WIFI_ARAYUZ" ]; then
    echo -e "${KIRMIZI}HATA: Wi-Fi kartÄ± bulunamadÄ±!${NC}"
    read -p "Ã‡Ä±kÄ±ÅŸ..." wait; exit 1
fi

echo -e "${CYAN}[AÄž]${NC} Hotspot kontrol ediliyor..."
AKTIF_BAGLANTI=$(nmcli connection show --active | grep "HavaKalitesi")

if [ -z "$AKTIF_BAGLANTI" ]; then
    echo -e "${SARI}>> Hotspot baÅŸlatÄ±lÄ±yor (HavaKalitesi / 12345678)...${NC}"
    
    # Eski veya hatalÄ± baÄŸlantÄ±larÄ± temizle
    sudo nmcli connection delete "HavaKalitesi" > /dev/null 2>&1
    sudo nmcli device disconnect "$WIFI_ARAYUZ" > /dev/null 2>&1
    nmcli radio wifi on
    
    # Yeni Hotspot OluÅŸtur
    sudo nmcli con add type wifi ifname "$WIFI_ARAYUZ" con-name "HavaKalitesi" autoconnect yes ssid "HavaKalitesi" > /dev/null 2>&1
    sudo nmcli con modify "HavaKalitesi" 802-11-wireless.mode ap 802-11-wireless.band bg ipv4.method shared > /dev/null 2>&1
    sudo nmcli con modify "HavaKalitesi" wifi-sec.key-mgmt wpa-psk wifi-sec.psk "12345678" > /dev/null 2>&1
    
    # BaÄŸlantÄ±yÄ± Aktif Et
    sudo nmcli con up "HavaKalitesi" > /dev/null 2>&1
    echo -e "${YESIL}>> Hotspot aktif edildi!${NC}"
fi

sleep 3

# IP Adresini Bul
IP_ADRES=$(ip -4 addr show "$WIFI_ARAYUZ" | grep -oP '(?<=inet\s)\d+(\.\d+){3}')
if [ -z "$IP_ADRES" ]; then IP_ADRES="BULUNAMADI"; fi

echo -e "âœ… Hotspot IP: ${MAVI}$IP_ADRES${NC}"

echo -e "${CYAN}[SUNUCU]${NC} Port 3000 hazÄ±rlanÄ±yor..."
fuser -k 3000/tcp > /dev/null 2>&1 
pkill -f "node server.js" > /dev/null 2>&1
sleep 1

echo -e "${YESIL}ðŸš€ Sunucu BaÅŸlatÄ±ldÄ±!${NC}"
echo -e "Web ArayÃ¼zÃ¼: https://$IP_ADRES:3000"
echo -e "Durdurmak iÃ§in ${KIRMIZI}sistemi_kaldir.sh${NC} dosyasÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±n."

if [ "$IP_ADRES" != "BULUNAMADI" ]; then
    # HTTPS olarak aÃ§
    (sleep 5 && xdg-open "https://$IP_ADRES:3000") > /dev/null 2>&1 &
fi

node server.js           server.js icindeki cod const express = require('express');
const session = require('express-session');
const sqlite3 = require('sqlite3').verbose();
const crypto = require('crypto');
const bodyParser = require('body-parser');
const https = require('https'); 
const fs = require('fs');       
const WebSocket = require('ws'); 
const dilPaketi = require('./dil_paketi');
const os = require('os');

const app = express();
const port = 3000;
const DB_NAME = './sensor_verileri.db';

// --- GÃœVENLÄ°K (SSL) ---
const serverOptions = {
    key: fs.readFileSync('server.key'),
    cert: fs.readFileSync('server.crt')
};

// --- ALGORÄ°TMA AYARLARI ---
const MOVING_AVG_WINDOW = 30; 
const MEDIAN_WINDOW = 5;      
const CO2_HEDEF = 1000;       
const CO2_TOLERANS = 150;     

// HafÄ±za TamponlarÄ±
let bufferCO2 = [];
let bufferTemp = [];
let bufferPM25 = []; // Toz verileri burada birikecek
let fanDurumu = 0; 
let alarmDurumu = 0;

const db = new sqlite3.Database(DB_NAME);

// --- YARDIMCI FONKSÄ°YONLAR ---
function ortalamaAl(arr) {
    if (arr.length === 0) return 0;
    const sum = arr.reduce((a, b) => a + b, 0);
    return (sum / arr.length);
}

function medyanAl(arr) {
    if (arr.length === 0) return 0;
    const sorted = [...arr].sort((a, b) => a - b);
    return sorted[Math.floor(sorted.length / 2)];
}

function sifrele(text) { return crypto.createHash('md5').update(text).digest('hex'); }

// --- SUNUCU ---
app.set('view engine', 'ejs');
app.use(express.static('public'));
app.use(bodyParser.urlencoded({ extended: true }));
app.use(session({ secret: 'gizli_anahtar', resave: false, saveUninitialized: true }));

const server = https.createServer(serverOptions, app);
const wss = new WebSocket.Server({ server });

wss.on('connection', (ws, req) => {
    const ip = req.socket.remoteAddress;
    console.log(`[BAÄžLANTI] ESP32 (SSL) Geldi! IP: ${ip}`);

    ws.on('message', (message) => {
        try {
            const hamVeri = JSON.parse(message);
            
            // --- 1. TOZ SENSÃ–RÃœ FÄ°LTRESÄ° (YENÄ°) ---
            // EÄŸer sensÃ¶r 0 gÃ¶nderirse ve elimizde eski veri varsa, eskiyi kullan.
            let gelenPM = hamVeri.pm25;
            let sonGecerliPM = bufferPM25.length > 0 ? bufferPM25[bufferPM25.length - 1] : 0;

            if (gelenPM > 0) {
                bufferPM25.push(gelenPM);
            } else {
                // 0 geldi, eskiyi kullan (Grafik Ã§akÄ±lmasÄ±n diye)
                bufferPM25.push(sonGecerliPM);
                gelenPM = sonGecerliPM; 
            }

            // DiÄŸer verileri tampona ekle
            bufferCO2.push(hamVeri.co2);
            bufferTemp.push(hamVeri.sicaklik);

            // Pencere kaydÄ±rma (HafÄ±za ÅŸiÅŸmesin)
            if (bufferCO2.length > MOVING_AVG_WINDOW) bufferCO2.shift();
            if (bufferTemp.length > MOVING_AVG_WINDOW) bufferTemp.shift();
            if (bufferPM25.length > MEDIAN_WINDOW) bufferPM25.shift();

            // --- 2. ALGORÄ°TMALAR ---
            const islenmisCO2 = Math.round(ortalamaAl(bufferCO2));
            const islenmisTemp = parseFloat(ortalamaAl(bufferTemp).toFixed(1));
            // Toz iÃ§in medyan alÄ±yoruz (Filtreli diziden)
            const islenmisPM25 = medyanAl(bufferPM25); 

            // Fan KontrolÃ¼ (Histerezis)
            if (islenmisCO2 > (CO2_HEDEF + CO2_TOLERANS)) fanDurumu = 1;
            else if (islenmisCO2 < (CO2_HEDEF - CO2_TOLERANS)) fanDurumu = 0;
            
            // Alarm
            alarmDurumu = (islenmisCO2 > 2000) ? 1 : 0;
            if (alarmDurumu === 1) fanDurumu = 1;

            console.log(`[LOGIC] Ham: ${hamVeri.co2} | Ä°ÅŸlenmiÅŸ: ${islenmisCO2} | Fan: ${fanDurumu} | PM: ${islenmisPM25}`);

            // --- 3. KAYIT ---
            const stmt = db.prepare(`INSERT INTO olcumler 
                (ham_co2, islenmis_co2, sicaklik, nem, pm25, fan_durumu, alarm_durumu) 
                VALUES (?, ?, ?, ?, ?, ?, ?)`);
            // pm25 yerine filtrelenmiÅŸ islenmisPM25 yazÄ±yoruz
            stmt.run(hamVeri.co2, islenmisCO2, islenmisTemp, hamVeri.nem, islenmisPM25, fanDurumu, alarmDurumu);
            stmt.finalize();

        } catch (e) { console.error("HatalÄ± veri:", e); }
    });
});

// --- ROTALAR ---
app.use((req, res, next) => {
    if (!req.session.lang) req.session.lang = 'tr';
    if (req.query.lang) req.session.lang = req.query.lang;
    res.locals.lang = req.session.lang;
    res.locals.text = dilPaketi[req.session.lang];
    res.locals.user = req.session.user || null;
    next();
});

app.get('/', (req, res) => { if (req.session.girisYapti) res.redirect('/dashboard'); else res.redirect('/login'); });
app.get('/login', (req, res) => { res.render('login', { hata: null }); });
app.post('/login', (req, res) => {
    const { kadi, sifre } = req.body;
    db.get("SELECT * FROM kullanicilar WHERE kullanici_adi = ? AND sifre = ?", [kadi, sifrele(sifre)], (err, user) => {
        if (user) {
            req.session.girisYapti = true;
            req.session.user = user;
            res.redirect('/dashboard');
        } else { res.render('login', { hata: "HatalÄ± GiriÅŸ!" }); }
    });
});

app.get('/dashboard', (req, res) => {
    if (!req.session.girisYapti) return res.redirect('/login');
    db.get("SELECT * FROM olcumler ORDER BY id DESC LIMIT 1", [], (err, sonVeri) => {
        db.all("SELECT * FROM olcumler ORDER BY id DESC LIMIT 50", [], (err, gecmis) => {
            db.all("SELECT * FROM loglar ORDER BY id DESC LIMIT 50", [], (err, loglar) => {
                const veri = sonVeri || { sicaklik: 0, nem: 0, islenmis_co2: 0, pm25: 0, fan_durumu: 0, alarm_durumu: 0 };
                res.render('dashboard', { 
                    sensor: {
                        sicaklik: veri.sicaklik,
                        nem: veri.nem,
                        // Ekranda iÅŸlenmiÅŸ veri gÃ¶rÃ¼nsÃ¼n
                        co2: veri.islenmis_co2 || veri.co2, 
                        pm25: veri.pm25
                    },
                    alarm: (veri.alarm_durumu === 1),
                    fan: (veri.fan_durumu === 1),
                    gecmis: gecmis.reverse(), 
                    konsol: loglar 
                });
            });
        });
    });
});

app.get('/admin', (req, res) => { if(req.session.user?.rol === 'admin') db.all("SELECT * FROM kullanicilar", [], (e,u)=> res.render('admin',{users:u})); else res.redirect('/dashboard'); });
app.get('/logout', (req, res) => { req.session.destroy(); res.redirect('/login'); });

function getIPAddress() {
  const interfaces = os.networkInterfaces();
  for (const devName in interfaces) {
    const iface = interfaces[devName];
    for (const alias of iface) {
      if (alias.family === 'IPv4' && alias.address !== '127.0.0.1' && !alias.internal) return alias.address;
    }
  }
  return '0.0.0.0';
}

server.listen(port, '0.0.0.0', () => {
    const ip = getIPAddress();
    console.log(`âœ… SUNUCU BAÅžLADI: https://localhost:${port}`);
    console.log(`ðŸ“¡ ESP32 IP: wss://${ip}:${port}`); 
}); bu         db_kurulum.js icindeki cod const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./sensor_verileri.db');
const crypto = require('crypto');

function sifrele(text) { return crypto.createHash('md5').update(text).digest('hex'); }

db.serialize(() => {
    // 1. Ã–lÃ§Ã¼mler Tablosu (GÃœNCELLENDÄ°)
    // Ham veri ve Ä°ÅŸlenmiÅŸ veri ayrÄ±ldÄ±. Fan ve Alarm durumu eklendi.
    db.run(`CREATE TABLE IF NOT EXISTS olcumler (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        tarih DATETIME DEFAULT CURRENT_TIMESTAMP,
        ham_co2 INTEGER,        -- SensÃ¶rden gelen saf veri
        islenmis_co2 INTEGER,   -- Algoritmalarla dÃ¼zeltilmiÅŸ veri
        sicaklik REAL,
        nem REAL,
        pm25 INTEGER,
        fan_durumu INTEGER DEFAULT 0,  -- 0: KapalÄ±, 1: AÃ§Ä±k
        alarm_durumu INTEGER DEFAULT 0 -- 0: Normal, 1: Tehlike
    )`);

    // 2. KullanÄ±cÄ±lar
    db.run(`CREATE TABLE IF NOT EXISTS kullanicilar (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        kullanici_adi TEXT UNIQUE,
        sifre TEXT,
        rol TEXT,
        hatali_giris INTEGER DEFAULT 0,
        kilitli_mi INTEGER DEFAULT 0
    )`);

    // 3. Loglar
    db.run(`CREATE TABLE IF NOT EXISTS loglar (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        kullanici TEXT,
        islem TEXT,
        detay TEXT,
        tarih DATETIME DEFAULT CURRENT_TIMESTAMP
    )`);

    // Admin Ekle
    const stmt = db.prepare("INSERT INTO kullanicilar (kullanici_adi, sifre, rol) VALUES (?, ?, ?)");
    stmt.run("admin", sifrele("1234"), "admin", (err) => {
        if (!err) console.log("âœ… Admin kullanÄ±cÄ±sÄ± oluÅŸturuldu.");
    });
    stmt.finalize();

    console.log("âœ… VeritabanÄ± (SSL Uyumlu ve Algoritma Destekli) HazÄ±r.");
});
db.close(); bu        dashboard.ejs icindeki cod bu hocam 